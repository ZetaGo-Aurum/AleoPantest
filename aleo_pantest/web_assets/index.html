<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AleoPantest V3.1 - Modern Web Suite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #d1e4ff;
            --on-primary: #001d36;
            --secondary: #2e3033;
            --surface: #1a1c1e;
            --background: #111315;
            --text: #e2e2e6;
            --accent: #b3d1ff;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--background);
            color: var(--text);
        }

        .material-card {
            background-color: var(--surface);
            border-radius: 28px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .material-card:hover {
            background-color: #2a2c2f;
            transform: translateY(-6px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .sidebar-item {
            border-radius: 100px;
            transition: all 0.2s ease;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 24px;
            margin-bottom: 4px;
        }

        .sidebar-item.active {
            background-color: var(--primary);
            color: var(--on-primary);
            font-weight: 600;
        }

        .sidebar-item:hover:not(.active) {
            background-color: rgba(255, 255, 255, 0.08);
        }

        .btn-primary {
            background-color: var(--primary);
            color: var(--on-primary);
            border-radius: 100px;
            padding: 14px 28px;
            font-weight: 600;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary:hover {
            background-color: var(--accent);
            transform: scale(1.02);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        pre {
            background-color: #0c0e10;
            border-radius: 20px;
            padding: 24px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .animate-fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .loading-shimmer {
            background: linear-gradient(90deg, #1a1c1e 25%, #2a2c2f 50%, #1a1c1e 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .input-field {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 14px 20px;
            width: 100%;
            color: white;
            transition: all 0.2s;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.08);
        }

        .category-badge {
            background: rgba(209, 228, 255, 0.1);
            color: var(--primary);
            padding: 4px 12px;
            border-radius: 100px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        /* Mobile Sidebar Overlay */
        #sidebar-overlay {
            display: none;
        }

        @media (max-width: 1024px) {
            aside {
                position: fixed;
                left: -300px;
                top: 0;
                bottom: 0;
                z-index: 50;
                transition: left 0.3s ease;
            }
            aside.open {
                left: 0;
            }
            #sidebar-overlay.open {
                display: block;
                position: fixed;
                inset: 0;
                background: rgba(0,0,0,0.5);
                backdrop-filter: blur(4px);
                z-index: 40;
            }
        }

        /* Toast Animation */
        .toast {
            animation: slideInRight 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            pointer-events: auto;
        }

        @keyframes slideInRight {
            from { transform: translateX(120%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .toast-exit {
            animation: slideOutRight 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(120%); opacity: 0; }
        }
    </style>
</head>
<body class="flex h-screen overflow-hidden">
    <!-- Sidebar Overlay for Mobile -->
    <div id="sidebar-overlay" onclick="toggleSidebar()"></div>

    <!-- Toast Notifications -->
    <div id="toast-container" class="fixed top-6 right-6 z-[100] flex flex-col gap-3 pointer-events-none"></div>

    <!-- Sidebar -->
    <aside id="sidebar" class="w-72 bg-surface p-6 flex flex-col border-r border-white/5 h-full">
        <div class="flex items-center gap-4 mb-10 px-4">
            <div class="w-12 h-12 bg-primary rounded-2xl flex items-center justify-center text-on-primary shadow-lg shadow-primary/20">
                <i class="fas fa-shield-halved text-xl"></i>
            </div>
            <div>
                <h1 class="text-lg font-bold tracking-tight leading-tight">AleoPantest</h1>
                <span class="text-xs font-semibold text-primary/80 uppercase tracking-widest">Version 3.1.0</span>
            </div>
        </div>
        
        <div class="px-4 mb-4">
            <div class="relative">
                <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-white/30 text-sm"></i>
                <input type="text" id="tool-search" placeholder="Search tools..." 
                    class="w-full bg-white/5 border border-white/10 rounded-full py-2.5 pl-10 pr-4 text-sm focus:outline-none focus:border-primary/50 transition-all">
            </div>
        </div>

        <nav class="flex-1 space-y-1 overflow-y-auto custom-scrollbar pr-2" id="category-list">
            <div class="loading-shimmer h-10 w-full rounded-full mb-2"></div>
            <div class="loading-shimmer h-10 w-full rounded-full mb-2"></div>
            <div class="loading-shimmer h-10 w-full rounded-full mb-2"></div>
        </nav>

        <div class="mt-auto pt-6 border-t border-white/5">
            <div class="bg-white/5 rounded-2xl p-4 flex items-center gap-3">
                <div class="relative">
                    <div class="w-3 h-3 rounded-full bg-green-500"></div>
                    <div class="absolute inset-0 w-3 h-3 rounded-full bg-green-500 animate-ping opacity-75"></div>
                </div>
                <div>
                    <p class="text-xs font-bold uppercase tracking-wider text-white/40">Status</p>
                    <p class="text-sm font-medium">System Online</p>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col overflow-hidden">
        <!-- Header -->
        <header class="h-20 flex items-center justify-between px-6 lg:px-10 border-b border-white/5 bg-surface/50 backdrop-blur-xl sticky top-0 z-10">
            <div class="flex items-center gap-4">
                <button onclick="toggleSidebar()" class="lg:hidden w-10 h-10 rounded-full bg-white/5 flex items-center justify-center">
                    <i class="fas fa-bars"></i>
                </button>
                <h2 id="current-category" class="text-xl lg:text-2xl font-bold tracking-tight">Dashboard</h2>
                <div id="tool-count" class="bg-white/5 px-3 py-1 rounded-lg text-xs font-bold text-white/50">V3.1.0 PRO</div>
            </div>
            <div class="flex items-center gap-3">
                <div class="hidden md:flex flex-col items-end mr-2">
                    <span id="admin-host" class="text-[10px] font-bold text-white/30 uppercase tracking-tighter">UNKNOWN@DEVICE</span>
                    <span class="text-xs font-semibold text-primary">System Administrator</span>
                </div>
                <div class="hidden md:flex items-center gap-3 bg-white/5 px-4 py-2 rounded-full border border-white/10">
                    <div class="w-6 h-6 rounded-full bg-primary flex items-center justify-center text-[10px] text-on-primary font-bold">A</div>
                    <span class="text-sm font-semibold admin-name">Admin</span>
                </div>
            </div>
        </header>

        <!-- Content Area -->
        <div class="flex-1 overflow-y-auto p-6 lg:p-10 custom-scrollbar bg-background">
            <!-- Dashboard Home View -->
            <div id="dashboard-home" class="animate-fade-in">
                <div class="mb-12">
                    <h3 class="text-3xl lg:text-4xl font-bold mb-4">Welcome back, <span class="text-primary">Hunter</span></h3>
                    <p class="text-white/50 max-w-2xl text-base lg:text-lg">Akses lebih dari 400+ tools penetration testing profesional dari satu dashboard modern yang responsif.</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                    <div class="material-card p-6 border-l-4 border-primary">
                        <i class="fas fa-network-wired text-primary text-2xl mb-4"></i>
                        <h4 class="text-xl font-bold mb-1">Network Tools</h4>
                        <p class="text-sm text-white/40">Scanning, sniffing, and subnetting</p>
                    </div>
                    <div class="material-card p-6 border-l-4 border-accent">
                        <i class="fas fa-globe text-accent text-2xl mb-4"></i>
                        <h4 class="text-xl font-bold mb-1">Web Security</h4>
                        <p class="text-sm text-white/40">Vulnerability scanning and recon</p>
                    </div>
                    <div class="material-card p-6 border-l-4 border-green-400">
                        <i class="fas fa-user-secret text-green-400 text-2xl mb-4"></i>
                        <h4 class="text-xl font-bold mb-1">OSINT Suite</h4>
                        <p class="text-sm text-white/40">Information gathering and analysis</p>
                    </div>
                </div>

                <h4 class="text-xl font-bold mb-6 flex items-center gap-3">
                    <i class="fas fa-fire text-orange-400"></i>
                    Featured Tools
                </h4>
                <div id="featured-tools" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Featured tools will go here -->
                </div>
            </div>

            <!-- Tool Grid View -->
            <div id="tool-grid-container" class="hidden animate-fade-in">
                <div id="tool-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Tools will be loaded here -->
                </div>
            </div>

            <!-- Execution Panel -->
            <div id="execution-panel" class="hidden animate-fade-in">
                <button onclick="showGrid()" class="mb-8 flex items-center gap-2 text-primary hover:gap-4 transition-all font-semibold">
                    <i class="fas fa-arrow-left"></i> Back to Tools
                </button>
                
                <div class="material-card p-6 lg:p-10 mb-10">
                    <div class="flex flex-col xl:flex-row justify-between items-start gap-10">
                        <div class="flex-1 w-full">
                            <div class="flex items-center gap-3 mb-4">
                                <span id="exec-tool-cat" class="category-badge">NETWORK</span>
                                <span class="text-white/20">â€¢</span>
                                <span id="exec-tool-ver" class="text-xs font-bold text-white/40">VERSION 1.0.0</span>
                            </div>
                            <h3 id="exec-tool-name" class="text-3xl lg:text-4xl font-extrabold mb-4 tracking-tight">Tool Name</h3>
                            <p id="exec-tool-desc" class="text-base lg:text-lg text-white/60 leading-relaxed max-w-2xl mb-6">Description goes here...</p>
                            
                            <div id="tool-metadata" class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm bg-white/5 p-6 rounded-2xl border border-white/10">
                                <div>
                                    <p class="text-white/30 uppercase font-bold tracking-widest text-[10px] mb-1">Risk Level</p>
                                    <p id="meta-risk" class="font-semibold text-green-400">LOW</p>
                                </div>
                                <div>
                                    <p class="text-white/30 uppercase font-bold tracking-widest text-[10px] mb-1">Author</p>
                                    <p id="meta-author" class="font-semibold">AleoPantest</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="w-full xl:w-[450px] bg-white/5 rounded-3xl p-6 lg:p-8 border border-white/10">
                            <h4 class="text-sm font-bold uppercase tracking-widest text-white/40 mb-6">Execution Parameters</h4>
                            <form id="tool-form" class="space-y-6" onsubmit="event.preventDefault(); runTool();">
                                <!-- Dynamic form fields will be injected here -->
                                <div id="form-fields" class="space-y-6">
                                    <div>
                                        <label class="block text-sm font-semibold mb-2 ml-1">Target Host / URL</label>
                                        <input type="text" id="tool-target" placeholder="e.g. 192.168.1.1 or https://example.com" 
                                            class="input-field">
                                    </div>
                                </div>
                                <button id="run-btn" type="submit" class="btn-primary w-full justify-center group">
                                    <span>Run Tool</span>
                                    <i class="fas fa-play text-[10px] group-hover:translate-x-1 transition-transform"></i>
                                </button>
                            </form>
                        </div>
                    </div>
                </div>

                <div id="results-container" class="hidden animate-fade-in">
                    <div class="flex items-center justify-between mb-6">
                        <h4 class="text-xl font-bold flex items-center gap-3">
                            <i class="fas fa-poll text-primary"></i>
                            Execution Results
                        </h4>
                            <div class="flex gap-2">
                                <button onclick="copyResults()" class="w-10 h-10 rounded-xl bg-white/5 flex items-center justify-center hover:bg-white/10 transition-colors" title="Copy results">
                                    <i class="far fa-copy"></i>
                                </button>
                                <button onclick="downloadFormat('json')" class="w-10 h-10 rounded-xl bg-white/5 flex items-center justify-center hover:bg-white/10 transition-colors" title="Download JSON">
                                    <i class="fas fa-file-code"></i>
                                </button>
                                <button onclick="downloadFormat('txt')" class="w-10 h-10 rounded-xl bg-white/5 flex items-center justify-center hover:bg-white/10 transition-colors" title="Download TXT">
                                    <i class="fas fa-file-alt"></i>
                                </button>
                            </div>
                    </div>
                    <pre id="tool-results" class="custom-scrollbar text-sm font-mono text-primary/90 leading-relaxed overflow-x-auto"></pre>
                </div>
            </div>
        </div>
    </main>

    <script>
        let allTools = {};
        let currentCategoryId = 'Dashboard';
        let activeTool = null;
        let adminInfo = null;

        async function init() {
            try {
                await fetchAdminInfo();
                const response = await fetch('/api/tools');
                allTools = await response.json();
                renderCategories();
                showDashboard();
                loadFeaturedTools();
            } catch (err) {
                console.error("Failed to load tools:", err);
            }
        }

        async function fetchAdminInfo() {
            try {
                const response = await fetch('/api/admin');
                adminInfo = await response.json();
                updateAdminUI();
            } catch (error) {
                console.error('Error fetching admin info:', error);
            }
        }

        function updateAdminUI() {
            if (!adminInfo) return;
            const adminBadges = document.querySelectorAll('.admin-name');
            adminBadges.forEach(b => {
                if (b) b.innerText = adminInfo.username || 'admin';
            });
            
            const adminHost = document.getElementById('admin-host');
            if (adminHost) adminHost.innerText = `${adminInfo.username || 'admin'}@${adminInfo.hostname || 'localhost'}`;
            
            const welcomeHunter = document.querySelector('#dashboard-home h3');
            if (welcomeHunter) welcomeHunter.innerHTML = `Welcome back, <span class="text-primary">${adminInfo.username || 'Hunter'}</span>`;
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            
            const colors = {
                'success': 'bg-green-500 text-white',
                'error': 'bg-red-500 text-white',
                'warning': 'bg-yellow-500 text-black',
                'info': 'bg-primary text-on-primary'
            };
            
            const icons = {
                'success': 'fa-check-circle',
                'error': 'fa-exclamation-triangle',
                'warning': 'fa-exclamation-circle',
                'info': 'fa-info-circle'
            };
            
            toast.className = `toast ${colors[type]} px-6 py-4 rounded-2xl shadow-2xl flex items-center gap-4 min-w-[300px]`;
            toast.innerHTML = `
                <i class="fas ${icons[type]} text-xl"></i>
                <div class="flex-1">
                    <p class="font-bold">${type.toUpperCase()}</p>
                    <p class="text-sm opacity-90">${message}</p>
                </div>
                <button onclick="this.parentElement.remove()" class="opacity-50 hover:opacity-100 transition-all">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('toast-exit');
                setTimeout(() => toast.remove(), 300);
            }, 5000);
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
            document.getElementById('sidebar-overlay').classList.toggle('open');
        }

        function renderCategories() {
            const list = document.getElementById('category-list');
            list.innerHTML = '';
            
            const dashItem = document.createElement('div');
            dashItem.className = 'sidebar-item active';
            dashItem.id = 'side-dashboard';
            dashItem.innerHTML = `<i class="fas fa-th-large"></i> <span>Dashboard</span>`;
            dashItem.onclick = () => showDashboard();
            list.appendChild(dashItem);

            Object.keys(allTools).forEach(cat => {
                const item = document.createElement('div');
                item.className = 'sidebar-item';
                item.id = `side-${cat}`;
                const icon = getCategoryIcon(cat);
                item.innerHTML = `<i class="${icon}"></i> <span>${cat}</span>`;
                item.onclick = () => {
                    showCategory(cat);
                    if (window.innerWidth < 1024) toggleSidebar();
                };
                list.appendChild(item);
            });
        }

        function getCategoryIcon(cat) {
            const icons = {
                'Network': 'fas fa-network-wired',
                'Web': 'fas fa-globe',
                'Phishing': 'fas fa-fish',
                'Clickjacking': 'fas fa-mouse-pointer',
                'Security': 'fas fa-shield-alt',
                'OSINT': 'fas fa-user-secret',
                'Utilities': 'fas fa-tools',
                'Crypto': 'fas fa-key',
                'Wireless': 'fas fa-wifi',
                'Database': 'fas fa-database'
            };
            return icons[cat] || 'fas fa-folder';
        }

        function showDashboard() {
            document.querySelectorAll('.sidebar-item').forEach(el => el.classList.remove('active'));
            document.getElementById('side-dashboard').classList.add('active');
            
            document.getElementById('dashboard-home').classList.remove('hidden');
            document.getElementById('tool-grid-container').classList.add('hidden');
            document.getElementById('execution-panel').classList.add('hidden');
            document.getElementById('current-category').innerText = "Dashboard";
            document.getElementById('tool-count').innerText = "V3.1.0 PRO";
        }

        function loadFeaturedTools() {
            const featured = document.getElementById('featured-tools');
            featured.innerHTML = '';
            
            const featuredIds = ['advanced-dorking', 'api-analyzer', 'shodan-search', 'tech-stack', 'arp-scan'];
            let count = 0;

            Object.values(allTools).flat().forEach(t => {
                if (featuredIds.includes(t.id) && count < 6) {
                    featured.appendChild(createToolCard(t));
                    count++;
                }
            });
        }

        function showCategory(cat) {
            currentCategoryId = cat;
            document.querySelectorAll('.sidebar-item').forEach(el => el.classList.remove('active'));
            document.getElementById(`side-${cat}`).classList.add('active');

            document.getElementById('dashboard-home').classList.add('hidden');
            document.getElementById('tool-grid-container').classList.remove('hidden');
            document.getElementById('execution-panel').classList.add('hidden');
            
            document.getElementById('current-category').innerText = cat;
            
            const grid = document.getElementById('tool-grid');
            grid.innerHTML = '';
            for(let i=0; i<6; i++) {
                grid.innerHTML += `
                    <div class="material-card p-6 h-48 loading-shimmer opacity-20"></div>
                `;
            }

            setTimeout(() => {
                const tools = allTools[cat] || [];
                document.getElementById('tool-count').innerText = `${tools.length} TOOLS`;
                grid.innerHTML = '';
                
                if (tools.length === 0) {
                    grid.innerHTML = `
                        <div class="col-span-full py-20 text-center">
                            <i class="fas fa-box-open text-6xl text-white/10 mb-4"></i>
                            <p class="text-white/30">No tools found in this category.</p>
                        </div>
                    `;
                    return;
                }

                tools.forEach(tool => {
                    grid.appendChild(createToolCard(tool));
                });
            }, 500);
        }

        function createToolCard(tool) {
            const div = document.createElement('div');
            div.className = 'material-card p-6 cursor-pointer group flex flex-col h-full';
            div.onclick = () => openExecution(tool);
            
            div.innerHTML = `
                <div class="flex justify-between items-start mb-4">
                    <div class="w-12 h-12 bg-white/5 rounded-2xl flex items-center justify-center text-primary group-hover:bg-primary group-hover:text-on-primary transition-all duration-300">
                        <i class="${getCategoryIcon(tool.category)} text-lg"></i>
                    </div>
                    <span class="category-badge opacity-50 group-hover:opacity-100 transition-opacity">${tool.category}</span>
                </div>
                <h4 class="text-xl font-bold mb-2 group-hover:text-primary transition-colors">${tool.name}</h4>
                <p class="text-sm text-white/40 leading-relaxed mb-6 flex-1 line-clamp-2">${tool.description}</p>
                <div class="flex items-center text-xs font-bold uppercase tracking-widest text-primary opacity-0 group-hover:opacity-100 transition-all translate-x-[-10px] group-hover:translate-x-0">
                    Open Tool <i class="fas fa-chevron-right ml-2"></i>
                </div>
            `;
            return div;
        }

        function openExecution(tool) {
            if (!tool) {
                showToast("Error: Tool not found", "error");
                return;
            }
            activeTool = tool;
            document.getElementById('dashboard-home').classList.add('hidden');
            document.getElementById('tool-grid-container').classList.add('hidden');
            document.getElementById('execution-panel').classList.remove('hidden');
            
            document.getElementById('exec-tool-name').innerText = tool.name || "Unknown Tool";
            document.getElementById('exec-tool-desc').innerText = tool.description || "No description available.";
            document.getElementById('exec-tool-cat').innerText = tool.category || "General";
            document.getElementById('exec-tool-ver').innerText = tool.version ? `VERSION ${tool.version}` : "VERSION 1.0.0";
            
            const riskEl = document.getElementById('meta-risk');
            if (riskEl) {
                riskEl.innerText = tool.risk_level || "LOW";
                riskEl.className = `font-semibold ${getRiskColor(tool.risk_level || "LOW")}`;
            }
            
            const authorEl = document.getElementById('meta-author');
            if (authorEl) authorEl.innerText = tool.author || "AleoPantest Team";

            document.getElementById('tool-results').innerText = '';
            document.getElementById('results-container').classList.add('hidden');
            
            renderForm(tool);
        }

        function getRiskColor(level) {
            const colors = {
                'LOW': 'text-green-400',
                'MEDIUM': 'text-yellow-400',
                'HIGH': 'text-orange-400',
                'CRITICAL': 'text-red-500'
            };
            return colors[level] || 'text-white';
        }

        function renderForm(tool) {
            const formContainer = document.getElementById('form-fields');
            formContainer.innerHTML = '';

            if (tool.form_schema && tool.form_schema.length > 0) {
                tool.form_schema.forEach(field => {
                    const div = document.createElement('div');
                    div.className = 'animate-fade-in';
                    
                    let inputHtml = '';
                    if (field.type === 'select') {
                        inputHtml = `
                            <select name="${field.name}" class="input-field bg-surface border-white/10 text-white appearance-none cursor-pointer">
                                ${field.options.map(opt => `<option value="${opt}" ${opt === field.default ? 'selected' : ''}>${opt.toUpperCase()}</option>`).join('')}
                            </select>
                        `;
                    } else if (field.type === 'textarea') {
                        inputHtml = `<textarea name="${field.name}" placeholder="${field.placeholder || ''}" class="input-field h-32 resize-none" ${field.required ? 'required' : ''}></textarea>`;
                    } else {
                        inputHtml = `<input type="${field.type}" name="${field.name}" placeholder="${field.placeholder || ''}" class="input-field" ${field.required ? 'required' : ''} value="${field.default || ''}">`;
                    }

                    div.innerHTML = `
                        <label class="block text-sm font-semibold mb-2 ml-1 text-white/70">${field.label}</label>
                        <div class="relative">
                            ${inputHtml}
                            ${field.type === 'select' ? '<i class="fas fa-chevron-down absolute right-4 top-1/2 -translate-y-1/2 text-white/30 pointer-events-none"></i>' : ''}
                        </div>
                    `;
                    formContainer.appendChild(div);
                });
            } else {
                // Default target field
                formContainer.innerHTML = `
                    <div>
                        <label class="block text-sm font-semibold mb-2 ml-1">Target Host / URL</label>
                        <input type="text" id="tool-target" name="target" placeholder="e.g. 192.168.1.1 or https://example.com" 
                            class="input-field" required>
                    </div>
                `;
            }
        }

        function showGrid() {
            if (currentCategoryId === 'Dashboard') {
                showDashboard();
            } else {
                showCategory(currentCategoryId);
            }
        }

        function downloadFormat(format) {
            if (!activeTool) return;
            window.open(`/api/download/${activeTool.id}/${format}`, '_blank');
        }

        async function runTool() {
            if (!activeTool) return;
            
            const runBtn = document.getElementById('run-btn');
            const resultsContainer = document.getElementById('results-container');
            const resultsPre = document.getElementById('tool-results');
            
            runBtn.disabled = true;
            runBtn.innerHTML = `<span>Running...</span> <i class="fas fa-circle-notch animate-spin text-[10px]"></i>`;
            
            const formData = new FormData(document.getElementById('tool-form'));
            const params = {};
            let target = "";
            
            formData.forEach((value, key) => {
                if (key === 'target') target = value;
                else params[key] = value;
            });

            try {
                resultsContainer.classList.remove('hidden');
                resultsPre.innerText = "Initializing scan...\nWaiting for response from engine...";
                showToast(`Starting execution: ${activeTool.name}`, 'info');
                
                const response = await fetch('/api/run', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        tool_id: activeTool.id,
                        target: target,
                        params: params
                    })
                });
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    showToast(`Execution completed successfully`, 'success');
                    resultsPre.innerText = data.output;
                    // Add admin context to output
                    if (adminInfo) {
                        resultsPre.innerText = `[ADMIN CONTEXT: ${adminInfo.username}@${adminInfo.hostname}]\n[TIMESTAMP: ${new Date().toLocaleString()}]\n\n` + data.output;
                    }
                } else {
                    showToast(`Execution failed: ${data.message}`, 'error');
                    resultsPre.innerText = `ERROR: ${data.message}`;
                }
                resultsPre.scrollIntoView({ behavior: 'smooth' });
            } catch (error) {
                showToast(`System Error: ${error.message}`, 'error');
                resultsPre.innerText = `SYSTEM ERROR: ${error.message}`;
                resultsPre.classList.add('text-red-400');
            } finally {
                runBtn.disabled = false;
                runBtn.innerHTML = `<span>Run Tool</span> <i class="fas fa-play text-[10px] group-hover:translate-x-1 transition-transform"></i>`;
            }
        }

        // Search functionality
        document.getElementById('tool-search').oninput = (e) => {
            const query = e.target.value.toLowerCase();
            if (!query) {
                showDashboard();
                return;
            }

            document.getElementById('dashboard-home').classList.add('hidden');
            document.getElementById('tool-grid-container').classList.remove('hidden');
            document.getElementById('execution-panel').classList.add('hidden');
            document.getElementById('current-category').innerText = "Search Results";
            
            const grid = document.getElementById('tool-grid');
            grid.innerHTML = '';
            
            let count = 0;
            Object.values(allTools).flat().forEach(tool => {
                if (tool.id.includes(query) || tool.name.toLowerCase().includes(query)) {
                    grid.appendChild(createToolCard(tool));
                    count++;
                }
            });
            document.getElementById('tool-count').innerText = `${count} MATCHES`;
        };

        function copyResults() {
            const text = document.getElementById('tool-results').innerText;
            navigator.clipboard.writeText(text);
            const btn = document.querySelector('button[onclick="copyResults()"]');
            const icon = btn.querySelector('i');
            icon.className = 'fas fa-check text-green-400';
            setTimeout(() => icon.className = 'far fa-copy', 2000);
        }

        async function downloadFormat(format) {
            if (!activeTool) return;
            window.location.href = `/api/download/${activeTool.id}/${format}`;
        }

        init();
    </script>
</body>
</html>
